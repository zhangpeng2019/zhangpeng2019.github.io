<!DOCTYPE html>
<html>
    <head>
        <title>Unity内置渲染管线-基础语法 | 陈巧倩</title>
        <meta charset="utf-8">
<meta name="viewport" content="width=device-width,minimum-scale=1">









<link rel="stylesheet" href="/lib/icofont/icofont.min.css" />
<link rel="stylesheet" href="/css/syntax.css" />
<link rel="stylesheet" href="/css/style.css" />
<link rel="shortcut icon" href="/images/favicon.ico" type="image/x-icon" />

    </head>

    <body>
        <header class="header-wrapper">
    <div class="header">
        <a class="site-title" href="https://www.chenqiaoqian.com/">陈巧倩</a>

        <ul class="menu">
            
        </ul>
    </div>
</header>

        <main class="main-wrapper">
            <div class="main">
                

<section class="single">
    <h1 class="title">Unity内置渲染管线-基础语法</h1>

    <div class="tip">
        <time datetime="2023-07-03 11:13:34 &#43;0800 CST">2023/07/03</time>
        <span class="split">·</span>
        <span> 194 words </span>
        <span class="split">·</span>
        <span>
            1 minutes to read
        </span>
    </div>

    <div class="taxonomies">
        
        <div>
            Categories:
            
                <a href="/categories/unity">Unity</a>
            
        </div>
        

        
            <div>
                Tags:
                
                    <a href="/tags/buildin-render-pipeline">BuildIn Render Pipeline</a>
                
            </div>
        
    </div>

    <hr />

    <div class="content">
        <p>Shader(着色器)是用来实现图像渲染的，用来替代固定渲染管线的可编辑程序。</p>
<h2 id="unity-shader基础">Unity Shader基础 <a href="#unity-shader%e5%9f%ba%e7%a1%80" class="anchor">🔗</a></h2><h3 id="开发语言">开发语言 <a href="#%e5%bc%80%e5%8f%91%e8%af%ad%e8%a8%80" class="anchor">🔗</a></h3><p>在Unity中，所有的Unity Shader都通过ShaderLab来编写。ShaderLab是Unity提供编写Unity Shader的一种说明性语言。在Unity中通常使用着色器语言CG和HLSL嵌入进ShaderLab中。</p>
<h3 id="开发工具">开发工具 <a href="#%e5%bc%80%e5%8f%91%e5%b7%a5%e5%85%b7" class="anchor">🔗</a></h3><p>Shader代码编写推荐使用VSCode + ShaderlabVSCode(Free)</p>
<p><img src="/2023-07-03-unity-buildin-renderpipeline-base/2023-07-03-unity-buildin-renderpipeline-base-1.gif" alt=""></p>
<h3 id="下载build-in-shaders">下载Build In Shaders <a href="#%e4%b8%8b%e8%bd%bdbuild-in-shaders" class="anchor">🔗</a></h3><p><img src="/2023-07-03-unity-buildin-renderpipeline-base/2023-07-03-unity-buildin-renderpipeline-base-2.png" alt=""></p>
<p>在Unity官网下载Build In Shaders合集，以便参考。</p>
<h3 id="实例">实例 <a href="#%e5%ae%9e%e4%be%8b" class="anchor">🔗</a></h3><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c#" data-lang="c#"><span style="display:flex;"><span>Shader <span style="color:#e6db74">&#34;Study/Hello&#34;</span><span style="color:#75715e">//Shader的真正名字  可以是路径式的格式</span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/*材质球参数及UI面板
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	https://docs.unity3d.com/cn/current/Manual/SL-Properties.html
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	https://docs.unity3d.com/cn/current/ScriptReference/MaterialPropertyDrawer.html
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	https://zhuanlan.zhihu.com/p/93194054
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	*/</span>
</span></span><span style="display:flex;"><span>    Properties
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>        _MainTex (<span style="color:#e6db74">&#34;Texture&#34;</span>, <span style="color:#ae81ff">2D</span>) = <span style="color:#e6db74">&#34;white&#34;</span> {}
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	这是为了让你可以在一个Shader文件中写多种版本的Shader，但只有一个会被使用。
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	提供多个版本的SubShader，Unity可以根据对应平台选择最合适的Shader。
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">	*/</span>
</span></span><span style="display:flex;"><span>    SubShader
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">		标签属性，有两种：一种是SubShader层级，一种在Pass层级
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">		https://docs.unity3d.com/cn/current/Manual/SL-SubShaderTags.html
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">		https://docs.unity3d.com/cn/current/Manual/SL-PassTags.html
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">		*/</span>
</span></span><span style="display:flex;"><span>        Tags { <span style="color:#e6db74">&#34;RenderType&#34;</span>=<span style="color:#e6db74">&#34;Opaque&#34;</span> }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>		<span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">		Pass里面的内容Shader代码真正起作用的地方，
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">		一个Pass对应一个真正意义上运行在GPU上的完整着色器(Vertex-Fragment Shader)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">		一个SubShader里面可以包含多个Pass，每个Pass会被按顺序执行
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">		*/</span>
</span></span><span style="display:flex;"><span>        Pass
</span></span><span style="display:flex;"><span>        {
</span></span><span style="display:flex;"><span>            CGPROGRAM<span style="color:#75715e">//Shader代码从这里开始，以下为CG着色语言</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">#pragma vertex vert</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">#pragma fragment frag</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#960050;background-color:#1e0010">#</span>include <span style="color:#e6db74">&#34;UnityCG.cginc&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>			<span style="color:#75715e">//https://docs.unity3d.com/Manual/SL-VertexProgramInputs.html</span>
</span></span><span style="display:flex;"><span>			<span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">appdata</span>  <span style="color:#75715e">//CPU向顶点Shader提供的模型数据</span>
</span></span><span style="display:flex;"><span>			{
</span></span><span style="display:flex;"><span>				<span style="color:#75715e">//冒号后面的是特定语义词，告诉CPU需要哪些类似的数据</span>
</span></span><span style="display:flex;"><span>				float4 vertex : POSITION; <span style="color:#75715e">//模型空间顶点坐标</span>
</span></span><span style="display:flex;"><span>				half2 texcoord0 : TEXCOORD0; <span style="color:#75715e">//第一套UV</span>
</span></span><span style="display:flex;"><span>				half2 texcoord1 : TEXCOORD1; <span style="color:#75715e">//第二套UV</span>
</span></span><span style="display:flex;"><span>				half2 texcoord2 : TEXCOORD2; <span style="color:#75715e">//第二套UV</span>
</span></span><span style="display:flex;"><span>				half2 texcoord4 : TEXCOORD3;  <span style="color:#75715e">//模型最多只能有4套UV</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>				half4 color : COLOR; <span style="color:#75715e">//顶点颜色</span>
</span></span><span style="display:flex;"><span>				half3 normal : NORMAL; <span style="color:#75715e">//顶点法线</span>
</span></span><span style="display:flex;"><span>				half4 tangent : TANGENT; <span style="color:#75715e">//顶点切线(模型导入Unity后自动计算得到)</span>
</span></span><span style="display:flex;"><span>			};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">v2f</span>  <span style="color:#75715e">//自定义数据结构体，顶点着色器输出的数据，也是片元着色器输入数据</span>
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                float4 vertex : SV_POSITION;<span style="color:#75715e">//输出裁剪空间下的顶点坐标数据，给光栅化使用，必须要写的数据</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">//注意跟上方的TEXCOORD的意义是不一样的，上方代表的是UV，这里可以是任意数据。</span>
</span></span><span style="display:flex;"><span>				<span style="color:#75715e">//插值器：输出后会被光栅化进行插值，而后作为输入数据，进入片元Shader</span>
</span></span><span style="display:flex;"><span>				<span style="color:#75715e">//最多可以写16个：TEXCOORD0 ~ TEXCOORD15。</span>
</span></span><span style="display:flex;"><span>                float2 uv : TEXCOORD0;<span style="color:#75715e">//自定义数据体</span>
</span></span><span style="display:flex;"><span>            };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>			<span style="color:#75715e">/*
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">			Shader内的变量声明，如果跟上面Properties模块内的参数同名，就可以产生链接
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">			*/</span>
</span></span><span style="display:flex;"><span>            sampler2D _MainTex;
</span></span><span style="display:flex;"><span>            float4 _MainTex_ST;<span style="color:#75715e">//纹理坐标_ST固定写法</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            v2f vert (appdata v)
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                v2f o;
</span></span><span style="display:flex;"><span>                o.vertex = UnityObjectToClipPos(v.vertex);
</span></span><span style="display:flex;"><span>                o.uv = TRANSFORM_TEX(v.texcoord0, _MainTex);
</span></span><span style="display:flex;"><span>                UNITY_TRANSFER_FOG(o,o.vertex);
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> o;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            fixed4 frag (v2f i) : SV_Target
</span></span><span style="display:flex;"><span>            {
</span></span><span style="display:flex;"><span>                fixed4 col = tex2D(_MainTex, i.uv);
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> col;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>            ENDCG
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h4 id="properties">Properties <a href="#properties" class="anchor">🔗</a></h4><p>Properties语义块包含了一系列属性，这些属性会显式的出现在材质面板中。便于开发者在材质面板中能够方便地调整各种材质属性。</p>
<p><img src="/2023-07-03-unity-buildin-renderpipeline-base/2023-07-03-unity-buildin-renderpipeline-base-5.png" alt=""></p>
<h4 id="subshader">SubShader <a href="#subshader" class="anchor">🔗</a></h4><p>一个Unity Shader文件至少包含一个SubShader语义块。加载时，unity会扫描所有的SubShader语义块，并选择第一个能在目标平台上运行的SubShader。如果都不支持，会使用Fallback指定的Unity Shader。</p>
<p>仅在SubShader中使用的Tag</p>
<p><img src="/2023-07-03-unity-buildin-renderpipeline-base/2023-07-03-unity-buildin-renderpipeline-base-6.png" alt=""></p>
<h4 id="渲染状态设置">渲染状态设置 <a href="#%e6%b8%b2%e6%9f%93%e7%8a%b6%e6%80%81%e8%ae%be%e7%bd%ae" class="anchor">🔗</a></h4><p><img src="/2023-07-03-unity-buildin-renderpipeline-base/2023-07-03-unity-buildin-renderpipeline-base-4.png" alt=""></p>
<p>如果在SubShader块中设置了状态，就会应用到全部的Pass。可以在Pass中单独设置状态。</p>
<h4 id="pass">Pass <a href="#pass" class="anchor">🔗</a></h4><p>Shader代码真正起作用的地方，一个Pass对应一个真正意义上运行在GPU上的完整着色流程。</p>
<p>仅在SubShader中使用的Tag</p>
<p><img src="/2023-07-03-unity-buildin-renderpipeline-base/2023-07-03-unity-buildin-renderpipeline-base-7.png" alt=""></p>
<p>一个SubShader里面可以包含多个Pass，每个Pass会被按顺序执行。</p>
<p><img src="/2023-07-03-unity-buildin-renderpipeline-base/2023-07-03-unity-buildin-renderpipeline-base-3.png" alt=""></p>
<h3 id="结论">结论 <a href="#%e7%bb%93%e8%ae%ba" class="anchor">🔗</a></h3><p>搬砖愉快！</p>
    </div>

    
</section>


            </div>
            <div class="side">
                
                    <div class="side-recent">
    <h2 class="side-title">
        <a href="/post/">Recent Post</a>
    </h2>
    <hr />

    <ul>
        
            <li>
                <a href="/2023/07/03/2023-07-05-unity-mathematics-1/">游戏数学基础</a>
            </li>
        
            <li>
                <a href="/2023/07/03/buildin-renderpipeline-base/">Unity内置渲染管线-基础语法</a>
            </li>
        
            <li>
                <a href="/2023/07/02/dots-concepts-and-principles/">Unity Dots概念与原理</a>
            </li>
        
            <li>
                <a href="/2023/07/01/buildin-renderpipeline-overview/">Unity内置渲染管线-概述</a>
            </li>
        
            <li>
                <a href="/2023/06/17/designpattern-summary/">设计模式-总结</a>
            </li>
        
    </ul>
</div>

                
                <div class="side-categories">
    <h2>Categories</h2>
    <hr />

    <ul>
        
            <li>
                <a href="/categories/csharp">csharp(24)</a>
            </li>
        
            <li>
                <a href="/categories/unity">unity(7)</a>
            </li>
        
    </ul>
</div>

                <div class="side-tags">
    <h2>Tags</h2>
    <hr />

    <ul>
        
            <li>
                <a href="/tags/buildin-render-pipeline">buildin-render-pipeline (2)</a>
            </li>
        
            <li>
                <a href="/tags/design-pattern">design-pattern (24)</a>
            </li>
        
            <li>
                <a href="/tags/dots">dots (1)</a>
            </li>
        
            <li>
                <a href="/tags/mathematics">mathematics (1)</a>
            </li>
        
            <li>
                <a href="/tags/notifications">notifications (1)</a>
            </li>
        
            <li>
                <a href="/tags/quadtree">quadtree (1)</a>
            </li>
        
            <li>
                <a href="/tags/texturepacker">texturepacker (1)</a>
            </li>
        
    </ul>
</div>

            </div>
        </main>
        <footer class="footer">
    <div class="footer-row">
        
            
            
                <a class="footer-item" href="https://www.chenqiaoqian.com/post/index.xml">
                    Feed of Post
                    <i class="icofont-rss"></i>
                </a>
            
        

        
            
            
        
    </div>

    
</footer>

    </body>
</html>
